<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in to Avendus Capital</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="db.js"></script>
    <style>
        .login-body {
            background-color: var(--bg-orange);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .login-header {
            position: absolute;
            top: 2rem;
            left: 2rem;
            right: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .login-logo {
            width: 40px;
            height: 40px;
            /* Placeholder for the logo in the top left */
            background: #1e293b;
            color: #ff7e4d;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-weight: 900;
            font-size: 1.2rem;
        }

        .home-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
        }

        .login-card {
            background: white;
            width: 100%;
            max-width: 450px;
            padding: 3rem 2.5rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .login-card h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--text-navy);
        }

        .form-group {
            text-align: left;
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.4rem;
            color: var(--text-navy);
        }

        .form-group label .required {
            color: #ef4444;
        }

        .phone-input-wrapper {
            display: flex;
            gap: 0.5rem;
        }

        .country-code {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid #e2e8f0;
            padding: 0.6rem 0.8rem;
            border-radius: 8px;
            font-size: 0.9rem;
            background: #fff;
        }

        .phone-number-field {
            flex: 1;
            border: 1px solid #ef4444;
            /* Match the red border in screenshot */
            background: #fff5f5;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            outline: none;
        }

        .error-message {
            color: #ef4444;
            font-size: 0.75rem;
            margin-top: 0.3rem;
        }

        .password-wrapper {
            position: relative;
        }

        .password-field {
            width: 100%;
            border: 1px solid #e2e8f0;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            outline: none;
        }

        .eye-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            cursor: pointer;
            width: 18px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-navy);
            margin: 1.5rem 0;
        }

        .login-submit-btn {
            width: 100%;
            background: #93c5fd;
            /* Soft blue like in screenshot */
            color: white;
            border: none;
            padding: 0.8rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .terms-link {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .terms-link a {
            color: var(--text-navy);
            text-decoration: underline;
        }

        .register-section {
            margin-top: 2rem;
            font-size: 0.9rem;
            color: var(--text-navy);
        }

        .register-btn {
            display: block;
            margin-top: 0.5rem;
            color: #2563eb;
            text-decoration: none;
            font-weight: 600;
        }

        .divider {
            margin: 2rem 0;
            position: relative;
            height: 1px;
            background: #e2e8f0;
        }

        .divider::after {
            content: "or";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 0 1rem;
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .forgot-password {
            color: #eab308;
            /* Yellow/Gold link */
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Register Modal Styles */
        .register-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }

        .modal-container {
            background: white;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .modal-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f1f5f9;
            background: #f8fafc;
        }

        .modal-top-bar h2 {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
        }

        .modal-close-btn {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-body h1 {
            font-size: 1.6rem;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .reg-input-group {
            margin-bottom: 1.25rem;
        }

        .reg-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .reg-phone-wrapper {
            display: flex;
            gap: 0.75rem;
        }

        .reg-country-box {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border: 1px solid #e2e8f0;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
            background: white;
            min-width: 100px;
        }

        .reg-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .reg-input:focus {
            border-color: #3b82f6;
        }

        .reg-input.error-border {
            border-color: #ef4444;
            background: #fff5f5;
        }

        .reg-error-msg {
            color: #ef4444;
            font-size: 0.8rem;
            margin-top: 0.4rem;
            font-weight: 500;
        }

        .reg-password-wrapper {
            position: relative;
        }

        .reg-eye {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            cursor: pointer;
        }

        .reg-terms-text {
            font-size: 0.75rem;
            color: #94a3b8;
            line-height: 1.4;
            margin: 1.5rem 0;
        }

        .reg-terms-text a {
            color: #3b82f6;
            text-decoration: underline;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-reg-now {
            background: #93c5fd;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-reg-now.active {
            background: #3b82f6;
        }

        .btn-cancel {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
        }

        /* Forgot Password Modal Styles */
        .forgot-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }

        .forgot-step-header {
            display: flex;
            border-bottom: 5px solid #f1f5f9;
            margin-bottom: 2rem;
            position: relative;
        }

        .forgot-step {
            flex: 1;
            text-align: center;
            padding-bottom: 1rem;
            font-weight: 700;
            color: #cbd5e1;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .forgot-step.active {
            color: #1e293b;
        }

        .forgot-progress {
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 50%;
            height: 5px;
            background: #cbd5e1;
            transition: transform 0.3s;
        }

        .forgot-progress.step2 {
            transform: translateX(100%);
        }

        .forgot-instructions {
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .forgot-label {
            display: block;
            font-size: 0.95rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
            text-align: left;
        }

        .btn-verify {
            background: #93c5fd;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-verify.active {
            background: #3b82f6;
        }
    </style>
</head>

<body class="login-body">
    <div class="login-header">
        <div class="login-logo" style="width: auto; padding: 0 10px;">Avendus Capital</div>
        <a href="index.html" class="home-btn"><i data-lucide="home"></i></a>
    </div>

    <div class="login-card">
        <h1>Sign in to Avendus Capital</h1>

        <form id="loginForm">
            <div class="form-group">
                <label>Username <span class="required">*</span></label>
                <div class="phone-input-wrapper">
                    <div class="country-code">
                        <img src="https://flagcdn.com/w20/in.png" width="18" alt="India">
                        <span>+ 91</span>
                    </div>
                    <input type="tel" id="phoneNumber" class="phone-number-field"
                        placeholder="Enter 10-digit mobile number" maxlength="10" required>
                </div>
                <div id="phoneError" class="error-message" style="display: none;">Invalid Indian phone number (10 digits
                    required)</div>
            </div>

            <div class="form-group">
                <label>Password <span class="required">*</span></label>
                <div class="password-wrapper">
                    <input type="password" id="password" class="password-field" placeholder="Enter your password"
                        required>
                    <i data-lucide="eye-off" id="togglePassword" class="eye-icon"></i>
                </div>
            </div>

            <label class="remember-me">
                <input type="checkbox"> Remember Me
            </label>

            <button type="submit" class="login-submit-btn">Login</button>

            <p class="terms-link">I agree to the <a href="#">Terms & Condition</a></p>
        </form>

        <div class="register-section">
            <p>New to Avendus Capital?</p>
            <a href="javascript:void(0)" onclick="openRegister()" class="register-btn">Register now</a>
        </div>

        <div class="divider"></div>

        <a href="javascript:void(0)" onclick="openForgot()" class="forgot-password">Forgot your password or can't sign
            in?</a>
    </div>

    <script>
        lucide.createIcons();

        // Toggle Password Visibility
        const togglePassword = document.querySelector('#togglePassword');
        const password = document.querySelector('#password');
        togglePassword.addEventListener('click', () => {
            const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
            password.setAttribute('type', type);
            // Toggle icon (simple way)
            togglePassword.setAttribute('data-lucide', type === 'password' ? 'eye-off' : 'eye');
            lucide.createIcons();
        });

        // Login Logic
        const loginForm = document.getElementById('loginForm');
        const phoneNumber = document.getElementById('phoneNumber');
        const phoneError = document.getElementById('phoneError');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const num = phoneNumber.value;
            // If valid, check against DB
            phoneError.style.display = 'none';

            const result = await DB.login(num, password.value);

            if (!result.success) {
                alert(result.message);
                return;
            }

            phoneNumber.style.borderColor = '#22c55e'; // Green success

            // Show a simple success effect before redirect
            const btn = document.querySelector('.login-submit-btn');
            btn.textContent = 'Logging in...';
            btn.style.opacity = '0.7';

            setTimeout(() => {
                window.location.href = 'index.html?logged_in=true';
            }, 1000);
        });

        // Reset error on input
        phoneNumber.addEventListener('input', () => {
            phoneError.style.display = 'none';
            phoneNumber.style.borderColor = '#e2e8f0';
            phoneNumber.style.background = '#fff';
        });
    </script>

    <!-- Register Modal -->
    <div id="registerModal" class="register-modal">
        <div class="modal-container">
            <div class="modal-top-bar">
                <h2>Create Your Account</h2>
                <button class="modal-close-btn" onclick="closeRegister()"><i data-lucide="x" size="20"></i></button>
            </div>
            <div class="modal-body">
                <h1>Embark on Your Investment Journey with us</h1>

                <form id="registerForm">
                    <div class="reg-input-group">
                        <div class="reg-phone-wrapper">
                            <div class="reg-country-box">
                                <img src="https://flagcdn.com/w20/in.png" width="20" alt="India">
                                <span>+ 91</span>
                            </div>
                            <input type="tel" id="regMobile" class="reg-input" placeholder="Enter your mobile number"
                                maxlength="10">
                        </div>
                        <div id="regMobileError" class="reg-error-msg" style="display: none;">Enter a valid mobile
                            number
                        </div>
                    </div>

                    <div class="reg-input-group">
                        <label class="reg-label">Password</label>
                        <div class="reg-password-wrapper">
                            <input type="password" id="regPassword" class="reg-input">
                            <i data-lucide="eye-off" class="reg-eye" onclick="togglePass('regPassword', this)"></i>
                        </div>
                    </div>

                    <div class="reg-input-group">
                        <label class="reg-label">Confirm Password</label>
                        <div class="reg-password-wrapper">
                            <input type="password" id="regConfirmPassword" class="reg-input">
                            <i data-lucide="eye-off" class="reg-eye"
                                onclick="togglePass('regConfirmPassword', this)"></i>
                        </div>
                    </div>

                    <div class="reg-input-group">
                        <label class="reg-label">Invitation Code</label>
                        <input type="text" id="regInvitation" class="reg-input">
                    </div>

                    <div class="reg-terms-text">
                        By proceeding with registration, you confirm that you agree to our Terms and Privacy Policy. If
                        you have any questions regarding the system, we strongly recommend that you speak with your
                        advisor or Wealth Manager prior to completing your registration. <a href="#">Terms &
                            Condition</a>
                    </div>

                    <div class="modal-actions">
                        <button type="submit" class="btn-reg-now" id="btnRegSubmit">Register now</button>
                        <button type="button" class="btn-cancel" onclick="closeRegister()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function openRegister() {
            document.getElementById('registerModal').style.display = 'flex';
            lucide.createIcons();
        }

        function closeRegister() {
            document.getElementById('registerModal').style.display = 'none';
        }

        function togglePass(id, icon) {
            const input = document.getElementById(id);
            if (input.type === 'password') {
                input.type = 'text';
                icon.setAttribute('data-lucide', 'eye');
            } else {
                input.type = 'password';
                icon.setAttribute('data-lucide', 'eye-off');
            }
            lucide.createIcons();
        }

        // Register form logic
        const regForm = document.getElementById('registerForm');
        const regMobile = document.getElementById('regMobile');
        const regMobileError = document.getElementById('regMobileError');
        const btnRegSubmit = document.getElementById('btnRegSubmit');

        regMobile.addEventListener('input', () => {
            if (regMobile.value.length === 10) {
                regMobile.classList.remove('error-border');
                regMobileError.style.display = 'none';
                btnRegSubmit.classList.add('active');
            } else {
                btnRegSubmit.classList.remove('active');
            }
        });

        regForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const res = await DB.register(regMobile.value, document.getElementById('regPassword').value);
            if (!res.success) {
                alert(res.message);
                return;
            }

            // Successful registration simulation
            btnRegSubmit.textContent = 'Registering...';
            btnRegSubmit.style.opacity = '0.7';

            setTimeout(() => {
                window.location.href = 'index.html?logged_in=true';
            }, 1200);
        });

        // Forgot Password Logic
        function openForgot() {
            document.getElementById('forgotModal').style.display = 'flex';
            resetForgotModal();
            lucide.createIcons();
        }

        function closeForgot() {
            document.getElementById('forgotModal').style.display = 'none';
        }

        function resetForgotModal() {
            document.getElementById('forgotStep1').style.display = 'block';
            document.getElementById('forgotStep2').style.display = 'none';
            document.getElementById('step1Tab').classList.add('active');
            document.getElementById('step2Tab').classList.remove('active');
            document.getElementById('forgotProgress').classList.remove('step2');
        }

        const forgotMobile = document.getElementById('forgotMobile');
        const btnVerify = document.getElementById('btnVerify');

        forgotMobile.addEventListener('input', () => {
            if (forgotMobile.value.length === 10) {
                btnVerify.classList.add('active');
            } else {
                btnVerify.classList.remove('active');
            }
        });

        function handleVerify() {
            if (forgotMobile.value.length !== 10) return;

            // Move to Step 2
            document.getElementById('forgotStep1').style.display = 'none';
            document.getElementById('forgotStep2').style.display = 'block';
            document.getElementById('step1Tab').classList.remove('active');
            document.getElementById('step2Tab').classList.add('active');
            document.getElementById('forgotProgress').classList.add('step2');
        }

        async function handleReset() {
            const mobile = forgotMobile.value;
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmNewPassword').value;

            if (newPass !== confirmPass) {
                alert('Passwords do not match!');
                return;
            }

            const res = await DB.resetPassword(mobile, newPass);
            if (!res.success) {
                alert(res.message);
                return;
            }

            const btn = document.getElementById('btnResetFinal');
            btn.textContent = 'Updating...';
            btn.style.opacity = '0.7';

            setTimeout(() => {
                alert('Password reset successful! Please log in with your new password.');
                closeForgot();
            }, 1500);
        }
    </script>

    <!-- Forgot Password Modal -->
    <div id="forgotModal" class="forgot-modal">
        <div class="modal-container">
            <div class="modal-top-bar">
                <h2>Forgot Password</h2>
                <button class="modal-close-btn" onclick="closeForgot()"><i data-lucide="x" size="20"></i></button>
            </div>
            <div class="modal-body" style="padding-top: 1rem;">
                <div class="forgot-step-header">
                    <div class="forgot-step active" id="step1Tab">Verification</div>
                    <div class="forgot-step" id="step2Tab">Reset Password</div>
                    <div class="forgot-progress" id="forgotProgress"></div>
                </div>

                <!-- Step 1: Verification -->
                <div id="forgotStep1">
                    <div style="text-align: center; color: #64748b; font-size: 0.95rem; margin-bottom: 1.5rem;">Confirm
                        your credential</div>
                    <div class="forgot-instructions">
                        To reset your password, please contact your investment advisor or private wealth manager for
                        identity verification. A new verification code will be provided to you upon successful
                        verification.
                    </div>

                    <div class="reg-input-group">
                        <label class="forgot-label">Username</label>
                        <div class="reg-phone-wrapper">
                            <div class="reg-country-box">
                                <img src="https://flagcdn.com/w20/in.png" width="20" alt="India">
                                <span>+ 91</span>
                            </div>
                            <input type="tel" id="forgotMobile" class="reg-input" placeholder="Enter your mobile number"
                                maxlength="10">
                        </div>
                    </div>

                    <div class="reg-input-group">
                        <label class="forgot-label">Validation Code</label>
                        <input type="text" id="forgotCode" class="reg-input">
                    </div>

                    <div class="modal-actions" style="margin-top: 3rem;">
                        <button type="button" class="btn-verify" id="btnVerify" onclick="handleVerify()">Verify</button>
                        <button type="button" class="btn-cancel" onclick="closeForgot()">Cancel</button>
                    </div>
                </div>

                <!-- Step 2: Reset Password -->
                <div id="forgotStep2" style="display: none;">
                    <div style="text-align: center; color: #64748b; font-size: 0.95rem; margin-bottom: 1.5rem;">Enter
                        your new password</div>

                    <div class="reg-input-group">
                        <label class="forgot-label">New Password</label>
                        <div class="reg-password-wrapper">
                            <input type="password" id="newPassword" class="reg-input">
                            <i data-lucide="eye-off" class="reg-eye" onclick="togglePass('newPassword', this)"></i>
                        </div>
                    </div>

                    <div class="reg-input-group">
                        <label class="forgot-label">Confirm New Password</label>
                        <div class="reg-password-wrapper">
                            <input type="password" id="confirmNewPassword" class="reg-input">
                            <i data-lucide="eye-off" class="reg-eye"
                                onclick="togglePass('confirmNewPassword', this)"></i>
                        </div>
                    </div>

                    <div class="modal-actions" style="margin-top: 3rem;">
                        <button type="button" class="btn-verify active" id="btnResetFinal" onclick="handleReset()">Reset
                            Password</button>
                        <button type="button" class="btn-cancel" onclick="closeForgot()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
